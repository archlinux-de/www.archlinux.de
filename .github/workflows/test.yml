name: test

on:
  push:
  schedule:
    - cron: '0 1 */1 * *'

jobs:
#  build:
#    runs-on: ubuntu-latest
#    steps:
#      - uses: actions/checkout@v2
#      - name: Login to GitHub Packages Docker Registry
#        uses: docker/login-action@v1
#        with:
#          registry: docker.pkg.github.com
#          username: ${{ github.repository_owner }}
#          password: ${{ secrets.GITHUB_TOKEN }}
#      - run: make docker-build
#      - run: make docker-push

  test:
    runs-on: ubuntu-latest
#    needs: build
#    strategy:
#      matrix:
#        type: ['test', 'test-db', 'test-e2e']
    steps:
      - uses: actions/checkout@v2
#
#      - name: Composer cache
#        uses: actions/cache@v2
#        with:
#          path: api/vendor
#          key: composer-${{ hashFiles('api/composer.lock') }}
#          restore-keys: composer-
#
#      - name: Yarn cache
#        uses: actions/cache@v2
#        with:
#          path: app/node_modules
#          key: yarn-${{ hashFiles('app/yarn.lock') }}
#          restore-keys: yarn-
#
#      - name: Login to GitHub Packages Docker Registry
#        uses: docker/login-action@v1
#        with:
#          registry: docker.pkg.github.com
#          username: ${{ github.repository_owner }}
#          password: ${{ secrets.GITHUB_TOKEN }}
#      - run: make docker-build
      - run: make install
#      - run: make ${{ matrix.type }}
      - run: make test
      - run: make test-db
      - run: make test-e2e
